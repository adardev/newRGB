<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Casa Inteligente - Control de Dispositivos</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    html, body {
      background: #555e50;
      font-family: 'Segoe UI', sans-serif;
      color: #ffffff;
      text-align: center;
      margin: 0;
      padding: 30px 20px;
    }
    h1 {
      font-size: 4rem;
      color: #dedede;
      margin-bottom: 40px;
      animation: slideIn 1s ease;
    }
    .room-card {
      background: #3a3725;
      border-radius: 20px;
      padding: 25px;
      margin: 20px auto;
      max-width: 400px;
      box-shadow: 0 4px 25px rgba(0, 0, 0, 0.5);
      transition: transform 0.3s ease;
    }
    .room-card:hover {
      transform: scale(1.03);
    }
    .room-icon {
      font-size: 70px;
      margin-bottom: 15px;
      transition: all 0.4s ease;
    }
    .room-on {
      text-shadow: 0 0 25px #00ffaa;
    }
    h2 {
      margin-bottom: 20px;
    }
    .btn-toggle {
      padding: 12px 24px;
      font-size: 16px;
      margin: 10px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: background 0.3s, transform 0.2s;
    }
    .btn-toggle:hover {
      transform: scale(1.06);
    }
    .on { background-color: #2ecc71; color: white; }
    .off { background-color: #e74c3c; color: white; }
    #status {
      margin-top: 30px;
      font-size: 1.1rem;
      animation: fadeIn 0.5s ease-in-out;
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-40px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    #device-container {
    display: flex;
    justify-content: center;
    gap: 30px;
    flex-wrap: wrap;
    }
  </style>
</head>
<body>
  <h1>üå± Control de Invernadero üå±</h1>
  <br><br><br>

  <div id="device-container">
  <div class="room-card">
    <i id="icon-fan" class="room-icon fa-solid fa-fan" style="color: #858585;"></i>
    <h2>Ventilador</h2>
    <button class="btn-toggle on" data-id="fan" data-value="1">Encender</button>
    <button class="btn-toggle off" data-id="fan" data-value="0">Apagar</button>
  </div>

  <div class="room-card">
    <i id="icon-lamp" class="room-icon fa-solid fa-lightbulb" style="color: #858585;"></i>
    <h2>L√°mpara</h2>
    <button class="btn-toggle on" data-id="lamp" data-value="1">Encender</button>
    <button class="btn-toggle off" data-id="lamp" data-value="0">Apagar</button>
  </div>

  <div class="room-card">
    <i id="icon-pump" class="room-icon fa-solid fa-water" style="color: #858585;"></i>
    <h2>Bomba de Agua</h2>
    <button class="btn-toggle on" data-id="pump" data-value="1">Encender</button>
    <button class="btn-toggle off" data-id="pump" data-value="0">Apagar</button>
  </div>
</div>

  <div id="status"></div>

  <script>
    const estados = { fan: 0, lamp: 0, pump: 0 };

    function enviarDatos() {
      $.ajax({
        url: '/enviar_rgb/',
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(estados),
        success: function (response) {
          $('#status').html(`
            <p>‚úÖ Estado: ${response.status}</p>
            <p>üì§ Comando: ${response.comando}</p>
            <p>‚è∞ Hora: ${new Date().toLocaleTimeString()}</p>
          `);
        },
        error: function (xhr) {
          $('#status').html(`
            <p style="color:red">‚ùå Error: ${xhr.responseJSON?.message || 'Error desconocido'}</p>
          `);
        }
      });
    }

    $(document).ready(function () {
      $('.btn-toggle').click(function () {
        const id = $(this).data('id');
        const value = parseInt($(this).data('value'));
        const icon = $(`#icon-${id}`);

        if (id !== undefined) {
          estados[id] = value;

          if (value === 1) {
            icon.css('color', '#00ffaa').addClass('room-on');
          } else {
            icon.css('color', '#858585').removeClass('room-on');
          }

          enviarDatos();
        }
      });
    });
  </script>
</body>
</html>